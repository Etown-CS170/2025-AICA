<div class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 p-4 transition-colors duration-300">
  <div class="max-w-6xl mx-auto">
    
    <!-- Header -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6 transition-colors duration-300">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <img src="aica_complex-nobg.png" alt="AICA Logo" class="w-12 h-12">
          <div>
            <h1 class="text-3xl font-bold text-gray-800 dark:text-white">AICA</h1>
            <p class="text-gray-600 dark:text-gray-400 text-sm">AI Communication Assistant</p>
          </div>
        </div>
        
        <!-- Auth & Theme Section -->
        <div class="flex items-center gap-3">
          <!-- Theme Toggle Button -->
          <button 
            (click)="toggleTheme()"
            class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
            [title]="(theme$ | async) === 'light' ? 'Switch to dark mode' : 'Switch to light mode'">
            <lucide-icon 
              *ngIf="(theme$ | async) === 'light'" 
              [img]="Moon" 
              class="w-5 h-5 text-gray-700 dark:text-gray-300"></lucide-icon>
            <lucide-icon 
              *ngIf="(theme$ | async) === 'dark'" 
              [img]="Sun" 
              class="w-5 h-5 text-yellow-400"></lucide-icon>
          </button>

          <!-- Loading State -->
          <div *ngIf="(isAuthenticated$ | async) === null" class="text-gray-500 dark:text-gray-400">
            Loading...
          </div>
          
          <!-- Logged Out State -->
          <button 
            *ngIf="(isAuthenticated$ | async) === false"
            (click)="login()"
            class="flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
            <lucide-icon [img]="LogIn" class="w-5 h-5"></lucide-icon>
            Sign In
          </button>
          
          <!-- Logged In State -->
          <div *ngIf="(isAuthenticated$ | async) === true" class="flex items-center gap-4">
            <div class="flex items-center gap-3">
              <img 
                *ngIf="(user$ | async)?.picture" 
                [src]="(user$ | async)?.picture" 
                [alt]="(user$ | async)?.name"
                class="w-10 h-10 rounded-full border-2 border-blue-500">
              <div class="text-right">
                <p class="text-sm font-semibold text-gray-800 dark:text-white">{{ (user$ | async)?.name }}</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">{{ (user$ | async)?.email }}</p>
              </div>
            </div>
            <button 
              (click)="logout()"
              class="flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
              <lucide-icon [img]="LogOut" class="w-5 h-5"></lucide-icon>
              Sign Out
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Auth Required Message -->
    <div *ngIf="(isAuthenticated$ | async) === false" 
        class="bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 text-blue-700 dark:text-blue-300 px-4 py-3 rounded-lg mb-6 transition-colors duration-300">
      <p class="font-medium">üîê Please sign in to generate emails</p>
      <p class="text-sm mt-1">Sign in with Google, Microsoft, GitHub, Apple, or email/password</p>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg mb-6 transition-colors duration-300">
      <p class="font-medium">{{ errorMessage }}</p>
    </div>

    <!-- Success Message -->
    <div *ngIf="showCopySuccess" class="bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700 text-green-700 dark:text-green-300 px-4 py-3 rounded-lg mb-6 flex items-center gap-2 transition-colors duration-300">
      <lucide-icon [img]="Copy" class="w-5 h-5"></lucide-icon>
      <p class="font-medium">Copied to clipboard!</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      
      <!-- Controls Panel -->
      <div class="lg:col-span-1 space-y-4">
        
        <!-- Tone Selection -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-5 transition-colors duration-300">
          <div class="flex items-center justify-between mb-3">
            <h3 class="font-semibold text-gray-800 dark:text-white flex items-center gap-2">
              <div class="w-2 h-2 bg-orange-500 rounded-full"></div>
              Tone
            </h3>
            <button
              (click)="toggleCustomTone()"
              [class]="isCustomTone ? 'text-orange-600 dark:text-orange-400' : 'text-gray-400 dark:text-gray-500'"
              class="hover:text-orange-600 dark:hover:text-orange-400 transition-colors"
              title="Custom tone">
              <lucide-icon [img]="Edit3" class="w-4 h-4"></lucide-icon>
            </button>
          </div>
          
          <!-- Custom Tone Input -->
          <div *ngIf="isCustomTone" class="mb-3">
            <input
              type="text"
              [(ngModel)]="customTone"
              placeholder="e.g., Casual, Urgent, Apologetic..."
              class="w-full px-3 py-2 border border-orange-300 dark:border-orange-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors duration-300"
            />
          </div>
          
          <!-- Default Tone Buttons -->
          <div *ngIf="!isCustomTone" class="space-y-2">
            <button
              *ngFor="let tone of tones"
              (click)="toggleTone(tone.id)"
              [class]="selectedTone === tone.id 
                ? 'bg-orange-500 text-white shadow-md' 
                : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'"
              class="w-full px-4 py-3 rounded-lg text-sm font-medium transition-all">
              {{ tone.label }}
            </button>
          </div>
        </div>

        <!-- Audience Selection -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-5 transition-colors duration-300">
          <div class="flex items-center justify-between mb-3">
            <h3 class="font-semibold text-gray-800 dark:text-white flex items-center gap-2">
              <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
              Audience
            </h3>
            <button
              (click)="toggleCustomAudience()"
              [class]="isCustomAudience ? 'text-purple-600 dark:text-purple-400' : 'text-gray-400 dark:text-gray-500'"
              class="hover:text-purple-600 dark:hover:text-purple-400 transition-colors"
              title="Custom audience">
              <lucide-icon [img]="Edit3" class="w-4 h-4"></lucide-icon>
            </button>
          </div>
          
          <!-- Custom Audience Input -->
          <div *ngIf="isCustomAudience" class="mb-3">
            <textarea
              [(ngModel)]="customAudience"
              placeholder="e.g., CEO, Client, Team Member&#10;&#10;For multiple recipients:&#10;CEO and CFO&#10;Marketing Team&#10;Professor and Academic Advisor"
              rows="4"
              class="w-full px-3 py-2 border border-purple-300 dark:border-purple-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm resize-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors duration-300"
            ></textarea>
          </div>
          
          <!-- Default Audience Buttons -->
          <div *ngIf="!isCustomAudience" class="space-y-2">
            <button
              *ngFor="let audience of audiences"
              (click)="toggleAudience(audience.id)"
              [class]="selectedAudience === audience.id 
                ? 'bg-purple-500 text-white shadow-md' 
                : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'"
              class="w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all">
              <lucide-icon [img]="getAudienceIcon(audience.id)" class="w-5 h-5"></lucide-icon>
              <span class="font-medium">{{ audience.label }}</span>
            </button>
          </div>
        </div>

        <!-- Templates -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-5 transition-colors duration-300">
          <div class="flex items-center justify-between mb-3">
            <h3 class="font-semibold text-gray-800 dark:text-white flex items-center gap-2">
              <div class="w-2 h-2 bg-green-500 rounded-full"></div>
              Quick Templates
            </h3>
            <button
              (click)="toggleCustomTemplate()"
              [class]="isCustomTemplate ? 'text-green-600 dark:text-green-400' : 'text-gray-400 dark:text-gray-500'"
              class="hover:text-green-600 dark:hover:text-green-400 transition-colors"
              title="Custom template">
              <lucide-icon [img]="Edit3" class="w-4 h-4"></lucide-icon>
            </button>
          </div>

          <!-- Custom Template Input -->
          <div *ngIf="isCustomTemplate" class="mb-3">
            <textarea
              [(ngModel)]="customTemplate"
              (ngModelChange)="onCustomTemplateChange()"
              (keypress)="onKeyPress($event)"
              placeholder="e.g., Write a project update email"
              rows="3"
              class="w-full px-3 py-2 border border-green-300 dark:border-green-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-sm resize-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors duration-300"
            ></textarea>
          </div>

          <!-- Default Template Buttons -->
          <div *ngIf="!isCustomTemplate" class="space-y-2">
            <button
              *ngFor="let template of templates"
              (click)="selectTemplate(template)"
              [class]="selectedTemplate === template.id 
                ? 'bg-green-500 text-white shadow-md' 
                : 'bg-gray-100 dark:bg-gray-700 hover:bg-green-100 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300'"
              class="w-full text-left px-4 py-2 rounded-lg text-sm transition-colors">
              {{ template.name }}
            </button>
          </div>
        </div>

      </div>

      <!-- Chat Interface -->
      <div class="lg:col-span-2">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden flex flex-col h-[600px] transition-colors duration-300">
          
          <!-- Messages Area -->
          <div #messagesContainer class="flex-1 overflow-y-auto p-6 space-y-4">
            
            <!-- Empty State -->
            <div *ngIf="messages.length === 0" class="text-center text-gray-400 dark:text-gray-500 mt-20">
              <lucide-icon [img]="Mail" class="w-16 h-16 mx-auto mb-4 opacity-50"></lucide-icon>
              <p class="text-lg">Start composing your email</p>
              <p class="text-sm mt-2">Describe what you need or select a template</p>
            </div>

            <!-- Messages -->
            <div *ngFor="let message of messages" 
                 [class]="message.type === 'user' ? 'flex justify-end' : 'flex justify-start'">
              <div [class]="message.type === 'user' 
                   ? 'bg-blue-600 text-white' 
                   : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200'"
                   class="max-w-[85%] rounded-2xl p-4 transition-colors duration-300">
                
                <!-- User message metadata -->
                <div *ngIf="message.type === 'user'" class="flex flex-wrap gap-2 mb-2">
                  <div *ngIf="message.tone" class="flex items-center gap-1.5 px-2.5 py-1 bg-orange-500 rounded-md text-xs">
                    <div class="w-1.5 h-1.5 bg-white rounded-full"></div>
                    <span class="text-white font-medium">{{ message.tone }}</span>
                  </div>
                  <div *ngIf="message.audience" class="flex items-center gap-1.5 px-2.5 py-1 bg-purple-500 rounded-md text-xs">
                    <div class="w-1.5 h-1.5 bg-white rounded-full"></div>
                    <span class="text-white font-medium">{{ message.audience }}</span>
                  </div>
                </div>

                <!-- Message content -->
                <div class="whitespace-pre-wrap font-mono text-sm">{{ message.content }}</div>

                <!-- Copy button for AI messages -->
                <button *ngIf="message.type === 'ai'"
                        (click)="copyToClipboard(message.content)"
                        class="mt-3 flex items-center gap-2 px-3 py-2 text-sm border border-blue-300 dark:border-blue-600 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors">
                  <lucide-icon [img]="Copy" class="w-4 h-4"></lucide-icon>
                  Copy to clipboard
                </button>
              </div>
            </div>

            <!-- Loading indicator -->
            <div *ngIf="isGenerating" class="flex justify-start">
              <div class="bg-gray-100 dark:bg-gray-700 rounded-2xl p-4 transition-colors duration-300">
                <div class="flex gap-2">
                  <div class="w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce"></div>
                  <div class="w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                  <div class="w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                </div>
              </div>
            </div>

          </div>

          <!-- Input Area -->
          <div class="border-t border-gray-200 dark:border-gray-700 p-4 transition-colors duration-300">
            <!-- Current Selection Tags -->
            <div class="flex gap-2 mb-3">
              <!-- Tone Badge - Only show if tone is selected -->
              <div *ngIf="getCurrentTone()" 
                   class="flex items-center gap-2 px-3 py-1.5 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded-lg text-xs font-medium">
                <div class="w-1.5 h-1.5 bg-orange-500 rounded-full"></div>
                <span>{{ getCurrentTone() }}</span>
              </div>
              <!-- Audience Badge - Only show if audience is selected -->
              <div *ngIf="getCurrentAudience()" 
                   class="flex items-center gap-2 px-3 py-1.5 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-lg text-xs font-medium">
                <div class="w-1.5 h-1.5 bg-purple-500 rounded-full"></div>
                <span>{{ getCurrentAudience() }}</span>
              </div>
            </div>

            <div class="flex gap-3">
              <input
                type="text"
                [(ngModel)]="inputText"
                (keypress)="onKeyPress($event)"
                [disabled]="isGenerating"
                [placeholder]="isCustomTemplate ? 'Type in custom template above...' : 'Describe your email need...'"
                class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors duration-300" />
              
              <button
                (click)="onSend()"
                [disabled]="!canSend() || !(isAuthenticated$ | async)"
                class="px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:bg-gray-300 dark:disabled:bg-gray-700 disabled:cursor-not-allowed transition-colors flex items-center gap-2">
                <lucide-icon [img]="Send" class="w-5 h-5"></lucide-icon>
              </button>

              <button
                *ngIf="messages.length > 0"
                (click)="reset()"
                class="px-4 py-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors"
                title="Clear conversation">
                <lucide-icon [img]="RotateCcw" class="w-5 h-5"></lucide-icon>
              </button>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>